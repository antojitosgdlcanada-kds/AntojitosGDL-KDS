<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Cocina - Antojitos Guadalajara</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
<script src="https://kit.fontawesome.com/a076d05399.js"></script>
</head>
<body style="background:#fff5f0">
<div class="container mt-3">
  <h3 class="text-center text-danger"><i class="fas fa-concierge-bell"></i> Cocina</h3>
  <div id="orders"></div>
</div>
<script>
const server = "http://192.168.0.10:5000";
const audioListo = new Audio("assets/sounds/manos.mp3");
const audioCampana = new Audio("assets/sounds/campana.mp3"); // 游댒 sonido para nuevas 칩rdenes
let ultimoConteo = 0; // 游댒 control de nuevas 칩rdenes

async function cargar(){
  const res = await fetch(`${server}/orden/cocina`);
  const data = await res.json();
  const div = document.getElementById("orders");
  div.innerHTML = data.map(o=>`
    <div class='card mt-2 p-2'>
      <b>Mesa ${o.mesa}</b><br>${o.notas}
      <button class='btn btn-danger btn-sm mt-2' onclick='listo(${o.id})'>Listo</button>
    </div>
  `).join("");
  
  // 游댒 si hay m치s 칩rdenes que antes, sonar campana
  if (data.length > ultimoConteo) {
    audioCampana.play();
  }
  ultimoConteo = data.length;
}

async function listo(id){
  await fetch(`${server}/orden/${id}/listo`);
  audioListo.play();
  cargar();
}

setInterval(cargar, 4000);
cargar();
</script>
</body>
</html>
